<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup Admin - Gestor de Pizzas</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #e63946;
            margin-top: 0;
        }
        button {
            background: #e63946;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        button:hover {
            background: #d62828;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        .success {
            background: #c8e6c9;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
            display: none;
        }
        .error {
            background: #ffcdd2;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
            display: none;
        }
        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê Configurar Administrador</h1>
        <p>Esta p√°gina te ayudar√° a configurar tu cuenta como administrador en Firestore usando tu UID.</p>
        
        <div class="info">
            <h3>Instrucciones:</h3>
            <ol>
                <li>Haz clic en "Iniciar Sesi√≥n con Google"</li>
                <li>Inicia sesi√≥n con tu cuenta de administrador</li>
                <li>Haz clic en "Crear Documento de Admin"</li>
                <li>¬°Listo! Ya eres administrador por UID</li>
            </ol>
        </div>
        
        <div id="login-section">
            <button id="login-btn">Iniciar Sesi√≥n con Google</button>
        </div>
        
        <div id="admin-section" style="display: none;">
            <div class="info">
                <p><strong>Usuario:</strong> <span id="user-email"></span></p>
                <p><strong>UID:</strong> <code id="user-uid"></code></p>
            </div>
            <button id="create-admin-btn">Crear Documento de Admin en Firestore</button>
            <button id="logout-btn" style="background: #666;">Cerrar Sesi√≥n</button>
        </div>
        
        <div id="success-msg" class="success"></div>
        <div id="error-msg" class="error"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>
    
    <script>
        const loginSection = document.getElementById('login-section');
        const adminSection = document.getElementById('admin-section');
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const createAdminBtn = document.getElementById('create-admin-btn');
        const userEmailSpan = document.getElementById('user-email');
        const userUidSpan = document.getElementById('user-uid');
        const successMsg = document.getElementById('success-msg');
        const errorMsg = document.getElementById('error-msg');
        
        let currentUser = null;
        
        // Listener de autenticaci√≥n
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                loginSection.style.display = 'none';
                adminSection.style.display = 'block';
                userEmailSpan.textContent = user.email;
                userUidSpan.textContent = user.uid;
                console.log('Usuario autenticado:', user.uid, user.email);
            } else {
                currentUser = null;
                loginSection.style.display = 'block';
                adminSection.style.display = 'none';
            }
        });
        
        // Login
        loginBtn.addEventListener('click', async () => {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                await auth.signInWithPopup(provider);
            } catch (error) {
                showError('Error al iniciar sesi√≥n: ' + error.message);
            }
        });
        
        // Logout
        logoutBtn.addEventListener('click', async () => {
            await auth.signOut();
        });
        
        // Crear documento de admin
        createAdminBtn.addEventListener('click', async () => {
            if (!currentUser) {
                showError('No hay usuario autenticado');
                return;
            }
            
            createAdminBtn.disabled = true;
            createAdminBtn.textContent = 'Creando...';
            
            try {
                await firestore.collection('admins').doc(currentUser.uid).set({
                    email: currentUser.email,
                    displayName: currentUser.displayName || 'Admin',
                    photoURL: currentUser.photoURL || '',
                    isAdmin: true,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    createdBy: 'setup-script'
                });
                
                showSuccess(`¬°√âxito! El usuario ${currentUser.email} (UID: ${currentUser.uid}) ahora es administrador. Puedes cerrar esta p√°gina y volver a la aplicaci√≥n.`);
                createAdminBtn.textContent = '‚úì Admin Creado';
                
            } catch (error) {
                showError('Error al crear admin: ' + error.message);
                createAdminBtn.disabled = false;
                createAdminBtn.textContent = 'Crear Documento de Admin en Firestore';
            }
        });
        
        function showSuccess(message) {
            successMsg.textContent = message;
            successMsg.style.display = 'block';
            errorMsg.style.display = 'none';
        }
        
        function showError(message) {
            errorMsg.textContent = message;
            errorMsg.style.display = 'block';
            successMsg.style.display = 'none';
        }
    </script>
</body>
</html>
